{% extends "base.html" %}
{% block title %}Manage Patients{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2><i class="fas fa-users"></i> Manage Patients</h2>

  <form method="get" class="row g-3 my-3">
    <div class="col-md-8">
      <input type="text" class="form-control" name="search" value="{{ search }}" placeholder="Search by name, email, or phone">
    </div>
    <div class="col-md-4">
      <button class="btn btn-outline-primary w-100" type="submit"><i class="fas fa-search"></i> Search</button>
    </div>
  </form>

  {% if patients.items %}
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      {% for patient in patients.items %}
        <tr>
          <td>{{ patient.user.username }}</td>
          <td>{{ patient.user.email }}</td>
          <td>{{ patient.phone or 'â€”' }}</td>
          <td>
            <span class="badge bg-{{ 'success' if patient.user.is_active else 'danger' }}">{{ 'Active' if patient.user.is_active else 'Inactive' }}</span>
          </td>
          <td>
            {% if patient.user.is_active %}
            <a class="btn btn-sm btn-outline-danger" href="{{ url_for('admin.deactivate_patient', patient_id=patient.id) }}" title="Deactivate patient" onclick="return confirm('Deactivate this patient?')">
              <i class="fas fa-ban"></i>
            </a>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  {% if patients.pages > 1 %}
  <nav aria-label="Patients pagination">
    <div class="pagination justify-content-center" role="list">
      {% if patients.has_prev %}
      <div class="page-item" role="listitem"><a class="page-link" href="{{ url_for('admin.manage_patients', page=patients.prev_num, search=search) }}">Previous</a></div>
      {% endif %}
      {% for p in patients.iter_pages() %}
        {% if p %}
        <div class="page-item {{ 'active' if p == patients.page }}" role="listitem"><a class="page-link" href="{{ url_for('admin.manage_patients', page=p, search=search) }}">{{ p }}</a></div>
        {% endif %}
      {% endfor %}
      {% if patients.has_next %}
      <div class="page-item" role="listitem"><a class="page-link" href="{{ url_for('admin.manage_patients', page=patients.next_num, search=search) }}">Next</a></div>
      {% endif %}
    </div>
  </nav>
  {% endif %}
  {% else %}
  <p class="text-muted">No patients found.</p>
  {% endif %}
</div>
{% endblock %}
